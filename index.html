<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear mi Link AnÃ³nimo</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --bg-color: #000000;
            --card-bg: #121212;
            --primary-grad: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            --text-main: #ffffff;
            --error-red: #ff4d4d;
            --success-green: #4ade80;
        }
        body { background-color: var(--bg-color); color: var(--text-main); font-family: -apple-system, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; overflow-x: hidden; }
        .container { width: 100%; max-width: 400px; text-align: center; }
        .card { background-color: var(--card-bg); border-radius: 28px; padding: 40px 20px; border: 1px solid #333; }
        
        h1 { font-size: 1.8rem; margin-bottom: 10px; }
        p { color: #a0a0a0; margin-bottom: 30px; }
        input { width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 12px; border: 1px solid #333; background: #1a1a1a; color: white; box-sizing: border-box; outline: none; transition: 0.3s; }
        input:focus { border-color: #cc2366; }
        
        .btn { background: var(--primary-grad); color: white; border: none; width: 100%; padding: 16px; border-radius: 40px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn:disabled { opacity: 0.5; }

        /* ESTILO DEL AVISO PROFESIONAL (Toast) */
        #toast {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: #222;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 5px 20px rgba(0,0,0,0.8);
            transition: bottom 0.4s ease;
            z-index: 1000;
            white-space: nowrap;
            border: 1px solid #444;
        }
        #toast.show { bottom: 40px; }

        .link-box { margin-top: 20px; padding: 15px; background: #222; border-radius: 12px; display: none; word-break: break-all; border: 1px dashed #555; }
        .toggle-auth { background:none; border:none; color:#cc2366; margin-top:15px; cursor:pointer; font-weight: 600; }
    </style>
</head>
<body>

    <div class="container">
        <div class="card" id="auth-section">
            <h1 id="auth-title">Â¡ObtÃ©n tus propios mensajes!</h1>
            <p id="auth-desc">RegÃ­strate para crear tu link anÃ³nimo.</p>
            
            <input type="email" id="email" placeholder="Tu correo electrÃ³nico">
            <div id="confirm-container">
                <input type="email" id="email-confirm" placeholder="Confirma tu correo electrÃ³nico">
            </div>
            <input type="password" id="password" placeholder="Tu contraseÃ±a">
            
            <button id="auth-btn" class="btn" onclick="manejarAuth()">Crear mi cuenta</button>
            <button class="toggle-auth" id="toggle-btn" onclick="cambiarModo()">Â¿Ya tienes cuenta? Entrar</button>
        </div>

        <div class="card" id="link-section" style="display:none">
            <h1>Tu Link estÃ¡ listo ðŸš€</h1>
            <p>CÃ³pialo y ponlo en tu bio de Instagram.</p>
            <div class="link-box" id="link-display"></div>
            <button class="btn" onclick="copiarLink()">Copiar Link</button>
            <hr style="margin:25px 0; border:0; border-top:1px solid #333">
            <button class="btn" style="background:#222; border: 1px solid #444;" onclick="window.location.href='inbox.html'">Ir a mi Inbox ðŸ“¥</button>
        </div>
    </div>

    <div id="toast">Mensaje de prueba</div>

    <script>
        // CONFIGURACIÃ“N
        const supabaseUrl = 'https://wfnhkuilbtomvtijsiwm.supabase.co';
        const supabaseKey = 'sb_publishable_aZvk0W9vtNtcOkcvvpuzrA_qxgE6Kb5';
        const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

        let esModoLogin = false;

        // FUNCIÃ“N PARA MOSTRAR AVISOS PROFESIONALES
        function mostrarAviso(mensaje, tipo = "error") {
            const toast = document.getElementById('toast');
            toast.innerText = mensaje;
            toast.style.color = (tipo === "error") ? "var(--error-red)" : "var(--success-green)";
            
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3500);
        }

        function cambiarModo() {
            esModoLogin = !esModoLogin;
            const confirmField = document.getElementById('confirm-container');
            document.getElementById('auth-title').innerText = esModoLogin ? "Bienvenido de nuevo" : "Â¡ObtÃ©n tus propios mensajes!";
            document.getElementById('auth-btn').innerText = esModoLogin ? "Entrar" : "Crear mi cuenta";
            document.getElementById('toggle-btn').innerText = esModoLogin ? "Â¿No tienes cuenta? RegÃ­strate" : "Â¿Ya tienes cuenta? Entrar";
            confirmField.style.display = esModoLogin ? "none" : "block";
        }

        async function manejarAuth() {
            const email = document.getElementById('email').value;
            const emailConfirm = document.getElementById('email-confirm').value;
            const password = document.getElementById('password').value;
            const btn = document.getElementById('auth-btn');

            if (!email || !password || (!esModoLogin && !emailConfirm)) {
                mostrarAviso("Por favor, rellena todos los campos.");
                return;
            }

            if (!esModoLogin && email !== emailConfirm) {
                mostrarAviso("Â¡Los correos no coinciden!");
                return;
            }

            btn.disabled = true;
            btn.innerText = "Cargando...";

            if (esModoLogin) {
                const { data, error } = await _supabase.auth.signInWithPassword({ email, password });
                if (error) {
                    mostrarAviso("Error: " + error.message);
                    btn.disabled = false;
                    btn.innerText = "Entrar";
                } else {
                    mostrarPantallaLink(data.user.id);
                }
            } else {
                const { data, error } = await _supabase.auth.signUp({ email, password });
                if (error) {
                    mostrarAviso("Error: " + error.message);
                    btn.disabled = false;
                    btn.innerText = "Crear mi cuenta";
                } else {
                    mostrarAviso("Â¡Cuenta creada! Ya puedes entrar.", "success");
                    cambiarModo();
                    btn.disabled = false;
                }
            }
        }

        function mostrarPantallaLink(uid) {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('link-section').style.display = 'block';
            const link = window.location.origin + "/send.html?u=" + uid;
            const display = document.getElementById('link-display');
            display.innerText = link;
            display.style.display = 'block';
        }

        function copiarLink() {
            const link = document.getElementById('link-display').innerText;
            navigator.clipboard.writeText(link).then(() => {
                mostrarAviso("Â¡Link copiado al portapapeles!", "success");
            });
        }
    </script>
</body>
</html>